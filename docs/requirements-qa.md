# FacialControl 要件定義 QA ドキュメント

本ドキュメントは、FacialControl プロジェクトの要件定義をブラッシュアップするために、現状のプロジェクト構成・設定から読み取れる情報を基に、不明点・確認事項を QA（質問と回答）形式で整理したものです。

> **対象読者**: プロジェクトオーナー、開発メンバー
> **作成日**: 2026-01-28
> **ステータス**: 回答待ち（各 Q に対して回答を記入してください）

---

## 目次

1. [プロジェクト概要・目的](#1-プロジェクト概要目的)
2. [機能要件](#2-機能要件)
3. [対応プラットフォーム・動作環境](#3-対応プラットフォーム動作環境)
4. [キャラクターモデル](#4-キャラクターモデル)
5. [表情制御の仕様](#5-表情制御の仕様)
6. [物理シミュレーション](#6-物理シミュレーション)
7. [レンダリング・ビジュアル](#7-レンダリングビジュアル)
8. [入力・操作](#8-入力操作)
9. [タイムライン・アニメーション](#9-タイムラインアニメーション)
10. [非機能要件](#10-非機能要件)
11. [開発体制・計画](#11-開発体制計画)
12. [配布・ライセンス](#12-配布ライセンス)

---

## 1. プロジェクト概要・目的

### Q1-1. プロジェクトの最終的なゴールは何ですか？

**背景**: 現状の README には「# FacialControl」というタイトルのみ記載されており、プロジェクトの目的・ゴールが明記されていません。

**確認事項**:
- FacialControl は「アプリケーション（エンドユーザー向け製品）」ですか、それとも「ライブラリ / ツール（開発者向けアセット）」ですか？
- 3D キャラクターの表情をリアルタイムに制御するシステムという理解で合っていますか？

**回答**:
- ライブラリ（開発者向けアセット）である。OpenUPM へのリリースを想定している。
- 3D キャラクターの表情をリアルタイムに制御するシステムという理解で合っている。

**決定日**: 2026-01-28

---

### Q1-2. 想定するユースケースは何ですか？

**背景**: 表情制御システムの用途によって、要件が大きく変わります。

**確認事項**:
- VTuber 配信用のフェイシャルキャプチャ連動を想定していますか？
- ゲーム内のカットシーン・会話シーンでの表情演出を想定していますか？
- アバターの表情をGUIエディタで手動制御する用途ですか？
- 上記以外の用途がありますか？（例: VRChat 向け、教育用、研究用など）

**回答**:
- メインは VTuber 配信用のフェイシャルキャプチャ連動。
- サブとして、アバターの表情を GUI エディタで手動制御する用途も想定。後者はアバターの表情のベースとなる AnimationClip を効率的に作成するために使用する。

**決定日**: 2026-01-28

---

### Q1-3. 想定するターゲットユーザーは誰ですか？

**背景**: ユーザー層によって UI の複雑さや必要な機能が変わります。

**確認事項**:
- 開発者（Unity エンジニア）向けですか？
- クリエイター（3D モデラー、アニメーター）向けですか？
- 一般ユーザー（配信者など技術に詳しくない人）向けですか？

**回答**:
- 開発者（Unity エンジニア）向け。ライブラリ（プラグイン）のため。

**決定日**: 2026-01-28

---

## 2. 機能要件

### Q2-1. 実装予定の機能一覧はありますか？

**背景**: 現時点ではC#スクリプトが一つもなく、機能の実装はこれからの段階です。

**確認事項**:
- MVP（最小限の実用可能な製品）として必要な機能は何ですか？
- 将来的に追加したい機能のロードマップはありますか？
- 優先順位付きの機能一覧を作成する予定はありますか？

**回答**:
- 入力デバイス（ゲームコントローラ、キーボード等）を動的に切り替えられる構造が必要。Unity プラグインでは標準の InputSystem に対応する。
- 操作した表情はネットワーク経由で複数のクライアントアプリに送信・受信できる必要がある。複数端末間の伝送は UDP で行い、Unity プラグインでの送受信には uOsc を使用する想定。毎フレーム確実に受信するため、送受信は Unity の 1 フレーム間に複数回行う。
- 表情は複数の AnimationClip を設定した「プロファイル」によって抽象化される。各プロファイルには以下が含まれる:
  - 目や眉の BlendShape を含む基本の AnimationClip
  - 表情が目・口などどの部位に属するかを表すカテゴリ属性
  - ブレンドして使用するリップシンク用の AnimationClip
  - 入力時の遷移にかける時間
- プロファイルは Unity 以外の環境でも使用可能にするため、コア機能として JSON フォーマットで保存し、Unity 向けオプションとして ScriptableObject Asset に出力する。
- JSON から ScriptableObject への変換はランタイム機能のみで実装し、Asset ファイルへの保存のみ Editor ツールで行う。ビルド後のアプリでも表情設定を差し替えられる構造にする意図。
- 将来的には UnrealEngine、Blender、TouchDesigner 向けプラグインの提供もロードマップに含めるが、現時点では作業に入れる必要はない。
- 機能に優先度はなく、すべて実装が必要。

**決定日**: 2026-01-28

---

### Q2-2. 外部デバイス・サービスとの連携は必要ですか？

**背景**: 表情制御システムは、入力ソースによって設計が大きく異なります。

**確認事項**:
- Web カメラによるフェイシャルキャプチャ（ARKit / MediaPipe 等）に対応しますか？
- VR ヘッドセットのフェイストラッキング（Meta Quest Pro 等）に対応しますか？
- 外部ソフトウェア（VSeeFace、iFacialMocap 等）からのデータ受信に対応しますか？
- OSC / WebSocket 等のプロトコルでの外部連携は必要ですか？

**回答**:
- Web カメラによるフェイシャルキャプチャ（ARKit / MediaPipe 等）: 初回リリースには不要。ロードマップに追加。
- VR ヘッドセットのフェイストラッキング: 同様に初回リリースには不要。ロードマップに追加。
- 外部ソフトウェア連携: 明確なフォーマットが定まっているもの（VSeeFace、iFacialMocap 等）はロードマップに追加。
- OSC 以外のプロトコル対応: 現状不要だが、将来的に拡張できるようにインターフェースで抽象化する。

**決定日**: 2026-01-28

---

### Q2-3. データの保存・エクスポート機能は必要ですか？

**背景**: 表情データの再利用やアセット化の需要があるか確認が必要です。

**確認事項**:
- 表情プリセットの保存・読み込み機能は必要ですか？
- アニメーションクリップとしてのエクスポート機能は必要ですか？
- 設定ファイル（JSON 等）でのインポート / エクスポートは必要ですか？

**回答**: （要記入）

---

## 3. 対応プラットフォーム・動作環境

### Q3-1. 正式な対応プラットフォームはどれですか？

**背景**: プロジェクトには PC 用（`PC_RPAsset`、`PC_Renderer`）とモバイル用（`Mobile_RPAsset`、`Mobile_Renderer`）の両方のレンダリング設定が存在します。また、ProjectSettings に Android 関連の設定（フルスクリーンモード、解像度等）が含まれています。

**確認事項**:
- PC（Windows / macOS / Linux）のうち、どれが対象ですか？
- モバイル（Android / iOS）は正式な対応プラットフォームですか、それとも将来的な検討段階ですか？
- WebGL ビルドの対応は予定していますか？（Web 用の解像度設定 960x600 が存在）
- VR プラットフォーム対応は予定していますか？（VR モジュールが依存関係に含まれている）

**回答**: （要記入）

---

### Q3-2. 最低動作環境・推奨動作環境の定義はありますか？

**背景**: レンダリング品質とパフォーマンスのバランスを決めるために必要です。

**確認事項**:
- 最低限必要な GPU スペックはありますか？
- 対応するモバイルデバイスの世代（例: iPhone 12 以降、Android 10 以降など）に基準はありますか？
- Unity 6 (6000.3.2f1) の動作要件に加え、本プロジェクト固有の要件はありますか？

**回答**: （要記入）

---

### Q3-3. デフォルト解像度 1024x768 は仕様ですか？

**背景**: ProjectSettings で `defaultScreenWidth: 1024`、`defaultScreenHeight: 768` が設定されています。4:3 のアスペクト比は近年のアプリケーションでは一般的ではないため、意図的な設定か確認が必要です。

**確認事項**:
- この解像度は最終的な製品でも使用する想定ですか？
- 対応するアスペクト比（16:9、16:10、4:3 等）の仕様はありますか？
- ウィンドウリサイズ可否の設定（現在 `resizableWindow: 0` = 不可）は仕様ですか？

**回答**: （要記入）

---

## 4. キャラクターモデル

### Q4-1. 初音ミクモデルの位置づけは何ですか？

**背景**: `com.mikunote.hatsunemiku-sample` パッケージとして初音ミクモデルが導入されています。

**確認事項**:
- 開発・テスト用のサンプルモデルとしてのみ使用しますか？
- 製品リリース時にも同梱しますか？
- ライセンス上、初音ミクモデルを同梱・配布することは問題ありませんか？（ピアプロ・キャラクター・ライセンス等の確認）

**回答**: （要記入）

---

### Q4-2. 汎用的なモデル対応は必要ですか？

**背景**: 現状は初音ミクモデル専用の構成に見えますが、他のモデルへの汎用性が必要かによって設計方針が変わります。

**確認事項**:
- 任意の VRM フォーマットモデルの読み込みに対応しますか？
- FBX や glTF 等の一般的な 3D フォーマットに対応しますか？
- 対応するブレンドシェイプ（モーフターゲット）の命名規則・仕様はありますか？
- VRoid Studio / Blender 等で作成したモデルとの互換性を想定していますか？

**回答**: （要記入）

---

### Q4-3. モデルに求めるブレンドシェイプの仕様は定義されていますか？

**背景**: 表情制御にはブレンドシェイプ（モーフターゲット）が不可欠であり、その構成がシステム設計に直結します。

**確認事項**:
- 対応すべきブレンドシェイプの一覧（喜怒哀楽、口の開閉、まばたき、眉の動き等）はありますか？
- ARKit の 52 ブレンドシェイプに準拠しますか？
- VRM 標準のブレンドシェイプ（VRMBlendShapeProxy）に準拠しますか？
- 独自のブレンドシェイプ仕様を策定しますか？

**回答**: （要記入）

---

## 5. 表情制御の仕様

### Q5-1. 表情制御の方式は何を採用しますか？

**背景**: 表情制御にはいくつかの代表的な方式があり、プロジェクトの方針を明確にする必要があります。

**確認事項**:
- ブレンドシェイプ（モーフターゲット）ベースですか？
- ボーンベース（フェイシャルリグ）ですか？
- テクスチャ切り替え方式ですか？
- 上記の組み合わせですか？

**回答**: （要記入）

---

### Q5-2. 表情の遷移・補間の仕様はありますか？

**背景**: 表情が切り替わる際のスムーズさがユーザー体験に直結します。

**確認事項**:
- 表情間の補間（ブレンド）は必要ですか？
- 補間の方式（線形補間、イージング、アニメーションカーブ等）の指定はありますか？
- 遷移時間のデフォルト値や設定可能な範囲はありますか？
- 複数の表情の同時適用（例: 「笑顔」＋「ウィンク」）は対応しますか？

**回答**: （要記入）

---

### Q5-3. 表情プリセットの要件はありますか？

**背景**: ユーザーが直感的に使える表情プリセットはほとんどの表情制御システムで必要です。

**確認事項**:
- デフォルトで用意するプリセット表情の一覧はありますか？
- ユーザーがカスタムプリセットを作成・保存できる機能は必要ですか？
- プリセットのカテゴリ分け（感情、口の形、目の形など）は必要ですか？

**回答**: （要記入）

---

## 6. 物理シミュレーション

### Q6-1. MagicaCloth2 の使用目的は何ですか？

**背景**: MagicaCloth2 はクロスシミュレーション用のアセットで、パッケージとして導入されています。

**確認事項**:
- 髪の毛の物理演算に使用しますか？
- 衣装・アクセサリーの物理演算に使用しますか？
- 表情制御との連動（例: 頭を振る動きに連動した髪の揺れ）は必要ですか？
- パフォーマンスとのトレードオフをどのレベルで考えていますか？

**回答**: （要記入）

---

### Q6-2. 物理シミュレーションの品質設定は必要ですか？

**背景**: PC とモバイルの両方を対象とする場合、物理の品質調整が必要です。

**確認事項**:
- プラットフォーム別に物理演算の品質を切り替えますか？
- ユーザーが物理演算の品質を設定で変更できるようにしますか？
- 物理演算を無効にするオプションは必要ですか？

**回答**: （要記入）

---

## 7. レンダリング・ビジュアル

### Q7-1. lilToon シェーダーを選定した理由は何ですか？

**背景**: lilToon は VRChat 等で広く使われるトゥーンシェーダーで、多数の機能が有効化されています（lilToonSetting.json にて確認）。アニメ調の描画に特化しています。

**確認事項**:
- アニメ・トゥーン調のレンダリングが要件ですか？
- lilToon のどの機能（影、リムライト、エミッション、ファー等）が必須で、どの機能はオプションですか？
- AudioLink 機能（`LIL_FEATURE_AUDIOLINK` が有効）は使用する想定ですか？
- 将来的にシェーダーを変更する可能性はありますか？

**回答**: （要記入）

---

### Q7-2. PC とモバイルでビジュアル品質の差をどの程度許容しますか？

**背景**: PC 用とモバイル用で別々のレンダリングパイプライン設定が存在します。

**確認事項**:
- PC 版とモバイル版で同等のビジュアルを目指しますか？
- モバイル版で省略しても良い描画機能はありますか？
- LOD（Level of Detail）の対応は必要ですか？

**回答**: （要記入）

---

## 8. 入力・操作

### Q8-1. 新しい Input System を導入した目的は何ですか？

**背景**: `com.unity.inputsystem` (v1.17.0) が導入されており、新しい Input System を使用する設計です。

**確認事項**:
- どのような入力デバイスへの対応を想定していますか？（キーボード / マウス / ゲームパッド / タッチ / VR コントローラー等）
- 表情制御に対するユーザー操作はどのようなものを想定していますか？（例: ショートカットキー、スライダー操作、ジェスチャー等）
- 入力のカスタマイズ（キーバインド変更等）は必要ですか？

**回答**: （要記入）

---

### Q8-2. UI フレームワークの選定は済んでいますか？

**背景**: `com.unity.ugui` (v2.0.0) が導入されていますが、Unity には UI Toolkit という新しい UI システムもあります。

**確認事項**:
- ランタイム UI は uGUI（Canvas ベース）で構築しますか？
- Unity UI Toolkit の使用は検討していますか？
- エディタ拡張（Inspector カスタマイズ等）の開発は必要ですか？

**回答**: （要記入）

---

## 9. タイムライン・アニメーション

### Q9-1. Timeline パッケージの使用目的は何ですか？

**背景**: `com.unity.timeline` (v1.8.9) が導入されています。

**確認事項**:
- 表情アニメーションのシーケンス再生に使用しますか？
- カスタムの Timeline Track / Clip を作成する予定はありますか？
- Timeline と他のアニメーションシステム（Animator Controller 等）の使い分けはどうしますか？
- ライブ演出やリップシンク等のリアルタイム制御と Timeline の併用は必要ですか？

**回答**: （要記入）

---

### Q9-2. リップシンク（口の動きの同期）は対応しますか？

**背景**: 表情制御において、リップシンクは一般的な要件です。

**確認事項**:
- 音声入力に連動するリアルタイムリップシンクは必要ですか？
- テキストベース（音素データ）のリップシンクは必要ですか？
- 事前にベイクしたリップシンクアニメーションの再生で十分ですか？
- 対応する言語（日本語の母音 あいうえお / 英語の Viseme 等）はありますか？

**回答**: （要記入）

---

## 10. 非機能要件

### Q10-1. パフォーマンス目標はありますか？

**背景**: リアルタイムの表情制御では、フレームレートの安定が重要です。

**確認事項**:
- 目標フレームレートはいくつですか？（例: PC 60fps / モバイル 30fps）
- 表情制御処理にかけられる CPU / GPU 時間のバジェットはありますか？
- 同時に表示するキャラクター数の上限はありますか？
- メモリ使用量の上限はありますか？

**回答**: （要記入）

---

### Q10-2. テスト方針は策定されていますか？

**背景**: `com.unity.test-framework` (v1.6.0) が導入されており、テストの実施は考慮されています。

**確認事項**:
- 単体テスト（Edit Mode Test）の対象範囲はどこまでですか？
- 統合テスト（Play Mode Test）の対象範囲はどこまでですか？
- ビジュアルリグレッションテスト（スクリーンショット比較等）は必要ですか？
- テストカバレッジの目標値はありますか？
- CI/CD パイプラインの構築は予定していますか？

**回答**: （要記入）

---

### Q10-3. エラーハンドリング・ログ方針はありますか？

**背景**: 開発初期段階でログ方針を決めることで、デバッグの効率が向上します。

**確認事項**:
- ログレベル（Debug / Info / Warning / Error）の使い分け基準はありますか？
- エラー発生時のユーザーへの通知方法は決まっていますか？
- クラッシュレポートの収集は行いますか？

**回答**: （要記入）

---

## 11. 開発体制・計画

### Q11-1. 開発チームの体制はどうなっていますか？

**背景**: Git の履歴から NHidano が主な開発者であることが確認できますが、チーム規模が不明です。

**確認事項**:
- 開発メンバーは何名ですか？
- 役割分担（プログラマー、デザイナー、モデラー等）はありますか？
- コードレビューのフローは確立されていますか？（PR ベースの開発は確認済み）

**回答**: （要記入）

---

### Q11-2. マイルストーン・リリース計画はありますか？

**背景**: プロジェクトは初期段階（コミット 9 件、C# スクリプトなし）です。

**確認事項**:
- プロトタイプ完成の目標時期はありますか？
- アルファ / ベータ / リリースの各段階での目標機能は定義されていますか？
- デモやプレゼンテーションの予定はありますか？

**回答**: （要記入）

---

### Q11-3. コーディング規約・アーキテクチャ方針は策定されていますか？

**背景**: Copilot Instructions に「単一責任の原則に従ってください」「日本語でコメント」という方針は記載されています。

**確認事項**:
- C# のコーディング規約（命名規則、フォーマット等）は策定されていますか？
- アーキテクチャパターン（MVC / MVP / ECS 等）は決定していますか？
- ディレクトリ構成のルール（Scripts / Editor / Tests のフォルダ構成等）はありますか？
- 使用を推奨 / 禁止するデザインパターンはありますか？

**回答**: （要記入）

---

## 12. 配布・ライセンス

### Q12-1. プロジェクトのライセンスは決まっていますか？

**背景**: リポジトリに LICENSE ファイルが存在しません。

**確認事項**:
- オープンソースとして公開しますか？その場合のライセンスは？（MIT / Apache 2.0 / GPL 等）
- 商用利用は想定していますか？
- 依存パッケージ（lilToon、MagicaCloth2、初音ミクモデル）のライセンスとの整合性は確認済みですか？

**回答**: （要記入）

---

### Q12-2. 会社名が「DefaultCompany」のままですが、正式名称はありますか？

**背景**: ProjectSettings の `companyName` が Unity プロジェクト作成時のデフォルト値「DefaultCompany」のままです。

**確認事項**:
- 正式な会社名 / 組織名 / 個人名に変更する必要がありますか？
- ビルド時のバンドル ID やパッケージ名に影響するため、早期に確定が望ましいです。

**回答**: （要記入）

---

## 補足：現状のプロジェクトから読み取れた情報まとめ

以下は、既存のプロジェクト設定・構成から確認できた事実です。

| 項目 | 現状 |
|------|------|
| Unity バージョン | 6000.3.2f1 (Unity 6) |
| レンダリングパイプライン | URP v17.3.0（PC / モバイル別設定あり）|
| シェーダー | lilToon v45（トゥーンシェーダー）|
| 物理シミュレーション | MagicaCloth2 |
| キャラクターモデル | 初音ミクサンプルモデル |
| 入力システム | Input System v1.17.0 |
| タイムライン | Timeline v1.8.9 |
| テストフレームワーク | Unity Test Framework v1.6.0 |
| カラースペース | Linear |
| デフォルト解像度 | 1024x768 |
| シーン | SampleScene のみ |
| C# スクリプト | なし（未実装）|
| 開発方針 | PR ベース、日本語コメント、単一責任の原則 |
| ドキュメント | README（タイトルのみ）、Copilot Instructions |

---

## 回答記入の手引き

各質問に対して、以下のフォーマットで回答を記入してください。

```
**回答**:
（ここに回答を記入）

**決定日**: YYYY-MM-DD
**決定者**: （名前）
```

未決定の項目には以下のように記入してください。

```
**回答**: 未決定。次回ミーティングで議論予定。

**決定予定日**: YYYY-MM-DD
```
